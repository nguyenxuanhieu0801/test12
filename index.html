<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dual Listbox</title>
    <style>
      body {
        font-family: Arial, sans-serif;
      }

      .container {
        display: flex;
        justify-content: space-around;
        align-items: center;
        margin: 50px;
      }

      .listbox {
        border: 1px solid #ccc;
        padding: 10px;
      }

      .controls {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 0 20px;
      }

      button {
        margin: 5px 0;
      }

      select {
        width: 150px;
        height: 150px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="listbox" id="left-listbox">
        <h2>Left Listbox</h2>
        <select multiple id="left-select">
          <option value="item1">Item 1</option>
          <option value="item2">Item 2</option>
          <option value="item3">Item 3</option>
          <!-- Add more options as needed -->
        </select>
      </div>

      <div class="controls">
        <button id="move-right-button">Move Right</button>
        <button id="move-left-button">Move Left</button>
        <button id="move-up-button">Move Up</button>
        <button id="move-down-button">Move Down</button>
      </div>

      <div class="listbox" id="right-listbox">
        <h2>Right Listbox</h2>
        <select multiple id="right-select">
          <option value="item4">Item 6</option>
          <option value="item5">Item 7</option>
          <option value="item6">Item 8</option>
          <option value="item7">Item 9</option>
          <option value="item8">Item 10</option>
          <option value="item9">Item 11</option>
        </select>
      </div>
    </div>

    <script>
      var leftButton = document.getElementById('move-right-button');
      var rightButton = document.getElementById('move-left-button');
      var leftSelect = document.getElementById('left-select');
      var rightSelect = document.getElementById('right-select');

      var upButton = document.getElementById('move-up-button');
      var downButton = document.getElementById('move-down-button');

      leftButton.onclick = () => {
        moveItem('left-select', 'right-select');
      };

      rightButton.onclick = () => {
        moveItem('right-select', 'left-select');
      };

      leftSelect.addEventListener('blur', function () {
        clearSelection('left-select');
      });

      rightSelect.addEventListener('blur', function () {
        clearSelection('right-select');
      });

      leftButton.addEventListener('mousedown', function () {
        leftButton.clicked = true;
        clearSelection('left-select');
      });

      rightButton.addEventListener('mousedown', function () {
        rightButton.clicked = true;
        clearSelection('right-select');
      });

      leftButton.addEventListener('mouseup', function () {
        leftButton.clicked = false;
      });

      rightButton.addEventListener('mouseup', function () {
        rightButton.clicked = false;
      });

      function moveItem(sourceId, destinationId) {
        var sourceSelect = document.getElementById(sourceId);
        var destinationSelect = document.getElementById(destinationId);

        var selectedOptions = getSelectedOptions(sourceSelect);

        for (var i = 0; i < selectedOptions.length; i++) {
          destinationSelect.appendChild(selectedOptions[i]);
        }
      }

      function getSelectedOptions(select) {
        var result = [];
        var options = select.options;

        for (var i = 0; i < options.length; i++) {
          if (options[i].selected) {
            result.push(options[i]);
          }
        }

        return result;
      }

      function clearSelection(selectId) {
        var select = document.getElementById(selectId);

        if (select) {
          if (
            !select.contains(document.activeElement) &&
            !leftButton.clicked &&
            !rightButton.clicked &&
            !upButton.clicked &&
            !downButton.clicked
          ) {
            select.selectedIndex = -1;
          }
        }
      }

      //==========================

      upButton.addEventListener('mousedown', function () {
        leftButton.clicked = true;
        clearSelection('left-select');
      });

      downButton.addEventListener('mousedown', function () {
        rightButton.clicked = true;
        clearSelection('right-select');
      });

      upButton.addEventListener('mouseup', function () {
        leftButton.clicked = false;
      });

      downButton.addEventListener('mouseup', function () {
        rightButton.clicked = false;
      });

      upButton.onclick = () => {
        moveUpItem('right-select');
      };

      downButton.onclick = () => {
        moveDownItem('right-select');
      };

      function moveUpItem(selectId) {
        var select = document.getElementById(selectId);
        var selectedOptions = getSelectedOptions(select);

        // Sort selected options based on their current index
        selectedOptions.sort(function (a, b) {
          return a.index - b.index;
        });

        // Check if options are already at the top
        if (selectedOptions[0].index === 0) {
          alert('Cannot move further up.');
          return;
        }

        // Calculate the new index for each selected option
        var newIndex = selectedOptions[0].index - 1;

        // Move options to the new index
        for (var i = 0; i < selectedOptions.length; i++) {
          var option = selectedOptions[i];
          var currentIndex = option.index;

          // Remove the option from its current position
          select.remove(currentIndex);

          // Insert the option at the new index
          var newIndexAfterRemoval = newIndex > currentIndex ? newIndex - 1 : newIndex;
          select.add(option, newIndexAfterRemoval);

          // Update the newIndex for the next iteration
          newIndex++;
        }
      }

      function moveDownItem(selectId) {
        var select = document.getElementById(selectId);
        var selectedOptions = getSelectedOptions(select);

        // Sort selected options based on their current index
        selectedOptions.sort(function (a, b) {
          return a.index - b.index;
        });

        // Check if options are already at the bottom
        if (selectedOptions[selectedOptions.length - 1].index === select.options.length - 1) {
          alert('Cannot move further down.');
          return;
        }

        // Calculate the new index for each selected option
        var newIndex = selectedOptions[selectedOptions.length - 1].index + 1;

        // Move options to the new index
        for (var i = selectedOptions.length - 1; i >= 0; i--) {
          var option = selectedOptions[i];
          var currentIndex = option.index;

          // Remove the option from its current position
          select.remove(currentIndex);

          // Insert the option at the new index
          select.add(option, newIndex);

          // Update the newIndex for the next iteration
          newIndex--;
        }
      }
    </script>
  </body>
</html>
s
